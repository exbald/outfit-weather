<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feature #36 Test - Drawer Shows Outfit and One-Liner</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 { color: #333; }
        h2 { color: #666; font-size: 18px; margin-top: 0; }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
            font-size: 14px;
        }
        .pass { background: #d4edda; color: #155724; }
        .fail { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        .manual-test {
            background: #fff3cd;
            border: 2px solid #ffc107;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
        }
        .manual-test h3 {
            margin-top: 0;
            color: #856404;
        }
        iframe {
            width: 100%;
            height: 600px;
            border: 2px solid #ddd;
            border-radius: 8px;
            margin-top: 10px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
        }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <h1>Feature #36: Drawer Shows Outfit and One-Liner</h1>

    <div class="test-section">
        <h2>Verification Tests</h2>
        <div id="results"></div>
    </div>

    <div class="test-section">
        <h2>Manual Browser Test</h2>
        <div class="manual-test">
            <h3>Instructions:</h3>
            <ol>
                <li>Open the app in the iframe below</li>
                <li>Allow location permissions when prompted</li>
                <li>Wait for weather data to load</li>
                <li>Click or swipe up on the drawer handle at the bottom</li>
                <li>Verify the following:</li>
            </ol>
            <ul>
                <li>‚úÖ Large emoji outfit is displayed (48-64px)</li>
                <li>‚úÖ Friendly one-liner text appears below emojis</li>
                <li>‚úÖ Text is properly styled with appropriate colors</li>
                <li>‚úÖ Content is centered and readable</li>
            </ul>
        </div>
        <iframe id="app-frame" src="http://localhost:5173"></iframe>
    </div>

    <div class="test-section">
        <h2>Test Controls</h2>
        <button onclick="runAllTests()">Run All Tests</button>
        <button onclick="window.location.reload()">Reload Page</button>
    </div>

    <script>
        const results = [];

        function addResult(test, passed, details) {
            results.push({ test, passed, details });
            updateResults();
        }

        function updateResults() {
            const container = document.getElementById('results');
            container.innerHTML = results.map(r => `
                <div class="test-result ${r.passed ? 'pass' : 'fail'}">
                    <strong>${r.passed ? '‚úÖ' : '‚ùå'} ${r.test}</strong><br>
                    ${r.details}
                </div>
            `).join('');
        }

        async function testDrawerContentStructure() {
            try {
                const response = await fetch('http://localhost:5173');
                const html = await response.text();

                // Check if Drawer component exists
                const hasDrawer = html.includes('Drawer') || html.includes('drawer');
                addResult(
                    'Drawer component exists',
                    hasDrawer,
                    hasDrawer ? 'Drawer component is present in the app' : 'Drawer component not found'
                );

                // Check for outfit emoji display
                const hasEmojiDisplay = html.includes('emojis') || html.includes('emoji');
                addResult(
                    'Outfit emoji display present',
                    hasEmojiDisplay,
                    hasEmojiDisplay ? 'Outfit emoji display is implemented' : 'No emoji display found'
                );

                // Check for one-liner text
                const hasOneLiner = html.includes('oneLiner') || html.includes('one-liner');
                addResult(
                    'One-liner text display present',
                    hasOneLiner,
                    hasOneLiner ? 'One-liner text display is implemented' : 'No one-liner display found'
                );

                // Check for adaptive text colors
                const hasAdaptiveColors = html.includes('useAdaptiveTextColors');
                addResult(
                    'Adaptive text colors used',
                    hasAdaptiveColors,
                    hasAdaptiveColors ? 'Text colors adapt to weather conditions' : 'No adaptive colors found'
                );

                return hasDrawer && hasEmojiDisplay && hasOneLiner;
            } catch (error) {
                addResult('HTML structure check', false, `Error: ${error.message}`);
                return false;
            }
        }

        async function testDrawerSourceCode() {
            try {
                const response = await fetch('http://localhost:5173/src/components/Drawer.tsx');
                const source = await response.text();

                // Check for outfit emoji section (lines 268-283)
                const hasOutfitSection = source.includes('role="img"') &&
                                       source.includes('aria-label') &&
                                       source.includes('displayOutfit.emojis');

                addResult(
                    'Outfit section in drawer',
                    hasOutfitSection,
                    hasOutfitSection
                        ? 'Large emoji outfit display with proper ARIA labels (lines 268-283)'
                        : 'Outfit section not properly implemented'
                );

                // Check for one-liner text (lines 285-288)
                const hasOneLinerSection = source.includes('displayOutfit.oneLiner') &&
                                         source.includes('text-center text-xl');

                addResult(
                    'One-liner text displayed',
                    hasOneLinerSection,
                    hasOneLinerSection
                        ? 'Friendly one-liner text with proper styling (lines 285-288)'
                        : 'One-liner text not properly implemented'
                );

                // Check for proper styling
                const hasProperStyling = source.includes('text-6xl') &&  // Large emoji size
                                        source.includes('leading-none') &&
                                        source.includes('transition-all');

                addResult(
                    'Content styled appropriately',
                    hasProperStyling,
                    hasProperStyling
                        ? 'Text sizes, transitions, and spacing properly applied'
                        : 'Styling not properly applied'
                );

                // Check for accessibility
                const hasAccessibility = source.includes('role="tabpanel"') &&
                                        source.includes('aria-live="polite"');

                addResult(
                    'Accessibility features',
                    hasAccessibility,
                    hasAccessibility
                        ? 'Proper ARIA labels and live regions for screen readers'
                        : 'Missing accessibility features'
                );

                return hasOutfitSection && hasOneLinerSection && hasProperStyling;
            } catch (error) {
                addResult('Source code check', false, `Error: ${error.message}`);
                return false;
            }
        }

        function displaySummary() {
            const passed = results.filter(r => r.passed).length;
            const total = results.length;
            const percentage = Math.round((passed / total) * 100);

            const summaryDiv = document.createElement('div');
            summaryDiv.className = `test-result ${percentage === 100 ? 'pass' : 'info'}`;
            summaryDiv.innerHTML = `
                <strong>üìä Summary: ${passed}/${total} tests passed (${percentage}%)</strong>
            `;
            document.getElementById('results').appendChild(summaryDiv);
        }

        async function runAllTests() {
            document.getElementById('results').innerHTML = '<div class="test-result info">Running tests...</div>';
            results.length = 0;

            await testDrawerContentStructure();
            await testDrawerSourceCode();

            displaySummary();
        }

        // Auto-run tests on page load
        window.addEventListener('load', () => {
            setTimeout(runAllTests, 1000);
        });
    </script>
</body>
</html>
