<project_specification>
  <project_name>OutFitWeather</project_name>

  <overview>
    A Progressive Web App (PWA) that shows users what to wear based on current weather at their location. Users open the app, it gets their location via GPS, fetches weather data from Open-Meteo API, and displays a clean weather interface with a swipe-up drawer showing emoji outfit recommendations with friendly one-liners like "Bundle up! üß•üß£üß§" or "Perfect day üëïüëñüëü". The app answers the daily question "what should I wear?" without requiring users to mentally translate weather data into clothing decisions.
  </overview>

  <technology_stack>
    <frontend>
      <framework>React + Vite</framework>
      <styling>Tailwind CSS</styling>
      <architecture>PWA with service worker for offline caching</architecture>
    </frontend>
    <backend>
      <runtime>None - client-side only</runtime>
      <database>none - stateless application</database>
      <external_apis>Open-Meteo API (free, no authentication required)</external_apis>
    </backend>
    <communication>
      <api>REST API calls from client to Open-Meteo</api>
      <location>Browser Geolocation API</location>
    </communication>
  </technology_stack>

  <prerequisites>
    <environment_setup>
      Node.js 20+, npm, modern web browser (Chrome/Safari/Firefox/Edge)
    </environment_setup>
  </prerequisites>

  <feature_count>78</feature_count>

  <security_and_access_control>
    <user_roles>
      <role name="all_users">
        <permissions>
          - All app features available (no authentication required)
        </permissions>
        <protected_routes>
          - None (public app)
        </protected_routes>
      </role>
    </user_roles>
    <authentication>
      <method>none</method>
      <session_timeout>none</session_timeout>
      <password_requirements>none</password_requirements>
    </authentication>
    <sensitive_operations>
      - Location access handled via browser permission API with friendly error screen if denied
    </sensitive_operations>
  </security_and_access_control>

  <core_features>
    <Weather Display>
      - Hero section showing current temperature (large, bold)
      - "Feels like" apparent temperature displayed below current temp
      - City name from geocoding (coordinates to location lookup)
      - Weather condition icon and description (e.g., "Partly Cloudy")
      - High/low temperature for the day
      - UV Index display with basic context (low/moderate/high/extreme)
      - Wind speed display (km/h or mph based on locale)
      - Precipitation probability/forecast
      - Sunrise and sunset times
      - "Last updated" timestamp showing data freshness
      - Background color subtly shifts based on weather conditions (cool blues for cold, warm amber for hot, gray for overcast)
    </Weather Display>

    <Outfit Recommendations>
      - Now view: Outfit based on current apparent temperature and conditions
      - Today view: Outfit based on daily high/low range and worst weather of the day
      - Tomorrow view: Outfit based on tomorrow's forecast
      - Outfit logic uses apparent_temperature as base
      - Weather code modifiers for rain/snow/fog conditions
      - Wind speed modifier for windy conditions (add windbreaker)
      - UV index modifier (high UV = sunglasses/sunscreen reminder)
      - Precipitation probability modifier (chance of rain = umbrella suggestion)
      - Daytime check for sunglasses recommendations
      - Large emoji outfit display (48-64px)
      - Friendly one-liner text (e.g., "Bundle up!", "Perfect day", "Starts cool, warps up ‚Äî layers!")
    </Outfit Recommendations>

    <Drawer Interaction>
      - Swipe-up gesture to reveal outfit drawer
      - Collapsed state shows subtle handle bar and "Swipe up ¬∑ What to wear" hint
      - Expanded state shows full outfit recommendation with emojis and one-liner
      - Spring animation (smooth, slightly bouncy, iOS-like)
      - Previous/Next buttons to cycle between Now/Today/Tomorrow views
      - Tap outside drawer or swipe down to collapse
      - Frosted glass/blur effect on drawer background
    </Drawer Interaction>

    <Open-Meteo API Integration>
      - Fetch current weather data (temperature, apparent_temperature, weather_code, wind_speed_10m)
      - Fetch daily forecast (apparent_temperature_max, apparent_temperature_min, weather_code, precipitation_probability_max, uv_index_max)
      - Fetch UV index data
      - Fetch precipitation probability
      - Handle is_day flag for sunglasses logic
      - API error handling with retry functionality
      - Parse Open-Meteo weather codes into human-readable conditions
    </Open-Meteo API Integration>

    <Location Handling>
      - Request GPS location via browser Geolocation API
      - Show friendly location permission screen on first load
      - Handle location permission denied with guidance to open system settings
      - Handle GPS timeout (10 second threshold) with retry option
      - Reverse geocoding to convert coordinates to city name
      - Fallback error screen if location cannot be determined
    </Location Handling>

    <Caching>
      - Store weather data in localStorage or IndexedDB
      - Show cached data immediately on app load
      - 30-minute cache expiry threshold
      - Background refresh to fetch fresh data
      - Seamless update when fresh data arrives (no jarring refreshes)
      - Display "Last updated X mins ago" timestamp
      - Show "Updated just now" when fresh data is loaded
    </Caching>

    <Loading States>
      - Initial loading state with animated weather emoji or app logo
      - No spinners - calm, Apple-like loading experience
      - Show skeleton or cached data after 1 second threshold
      - Show subtle "Still fetching..." message after 5 seconds if still loading
      - Progressive loading - show cached data immediately, fetch fresh in background
    </Loading States>

    <Error Handling>
      - Location denied: Friendly screen with "We need your location" message + button to open system settings
      - No internet: Show cached data if available with "Last updated X mins ago" + pull-to-refresh hint. If no cache, show "No connection" message.
      - GPS timeout: "Couldn't find your location" + retry button
      - API failure: Same as no internet - cached data if available, otherwise "Couldn't fetch weather" + retry
      - Missing outfit data: Fallback to temperature-only logic. If temp missing, show "Couldn't determine outfit" + generic "Check outside! ü§∑"
      - No raw technical error messages - always friendly, helpful copy
    </Error Handling>

    <Settings>
      - Temperature unit toggle (Celsius/Fahrenheit)
      - Auto-detect units based on locale (US ‚Üí ¬∞F, everywhere else ‚Üí ¬∞C)
      - Wind speed unit toggle (km/h or mph) with same auto-detect logic
      - Settings accessible via subtle settings button
    </Settings>

    <Adaptive Backgrounds>
      - Freezing conditions: Slate blue (#e0e7ef)
      - Cold conditions: Cool blue (#dbeafe)
      - Cool conditions: Light gray-blue (#f1f5f9)
      - Mild conditions: Soft green (#ecfdf5)
      - Warm conditions: Warm amber (#fef3c7)
      - Hot conditions: Orange (#ffedd5)
      - Rain conditions: Gray-blue (#e2e8f0)
      - Night mode: Deeper variants of above colors
      - Dark/light mode follows system preference
    </Adaptive Backgrounds>

    <Visual Design>
      - System fonts (-apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif)
      - Standard emoji for weather icons (‚òÄÔ∏èüåßÔ∏è‚ùÑÔ∏è‚õàÔ∏è)
      - Large emoji display for outfit recommendations
      - Frosted glass drawer effect (transparency + blur)
      - Clean, uncluttered interface
      - Mobile-first responsive layout
    </Visual Design>

    <Pull-to-Refresh>
      - Native-feeling gesture to refresh weather data
      - Visual feedback during pull gesture
      - Loading indicator during refresh
      - Updates both weather and outfit data
    </Pull-to-Refresh>

    <PWA Features>
      - Web app manifest for installability
      - Service worker for offline caching
      - "Add to Home Screen" prompt after 2nd visit (not aggressive)
      - Works offline with cached data
      - App icon and splash screen
    </PWA Features>

    <Accessibility>
      - Semantic HTML structure
      - ARIA labels on drawer and interactive elements
      - Screen reader announces outfit + one-liner
      - Emoji have aria-labels (e.g., "coat, scarf, gloves, boots")
      - WCAG AA color contrast compliance
      - Keyboard navigation support
    </Accessibility>

    <Responsive Design>
      - Mobile-first layout optimized for phones
      - Acceptable rendering on desktop (centered content)
      - No complex desktop-specific layouts
      - Landscape mode support (centered content)
    </Responsive Design>
  </core_features>

  <database_schema>
    <tables>
      <!-- No database - stateless application -->
    </tables>
  </database_schema>

  <api_endpoints_summary>
    <Open-Meteo>
      - GET https://api.open-meteo.com/v1/forecast (current weather + daily forecast + UV + precipitation)
      - Uses latitude/longitude from Geolocation API
      - Parameters: current, daily, hourly, timezone, temperature_unit, wind_speed_unit
    </Open-Meteo>
    <Reverse Geocoding>
      - GET https://geocoding-api.open-meteo.com/v1/reverse (coordinates to city name)
      - Fallback: Use BigDataCloud or similar free API
    </Reverse Geocoding>
  </api_endpoints_summary>

  <ui_layout>
    <main_structure>
      Mobile-first single-screen layout with two primary states:

      **Main Weather View (default):**
      - Hero: Large current temperature at top
      - Sub-hero: "Feels like" temperature
      - Location: City name (subtle, small)
      - Conditions: Weather icon + description
      - Quick stats grid: High/Low, UV Index, Wind, Precipitation
      - Footer: Sunrise/sunset times, "Last updated" timestamp
      - Bottom: Collapsed drawer handle bar with "Swipe up ¬∑ What to wear" hint

      **Drawer (expanded):**
      - Frosted glass overlay with slide-up spring animation
      - Hero: Giant emoji outfit row (üß•üß£üß§ü•æ)
      - One-liner: Friendly text ("Bundle up!")
      - Navigation: Previous/Next buttons for Now/Today/Tomorrow
      - Current view indicator: "Now" / "Today" / "Tomorrow"

      **Settings Modal:**
      - Temperature unit toggle
      - Wind speed unit toggle
      - Done/Close button

      **Error Screens:**
      - Centered friendly message with relevant emoji
      - Clear action button (retry, open settings, etc.)
    </main_structure>
  </ui_layout>

  <design_system>
    <color_palette>
      Light mode backgrounds by condition:
      - Freezing: #e0e7ef (slate blue)
      - Cold: #dbeafe (cool blue)
      - Cool: #f1f5f9 (light gray-blue)
      - Mild: #ecfdf5 (soft green)
      - Warm: #fef3c7 (warm amber)
      - Hot: #ffedd5 (orange)
      - Rain: #e2e8f0 (gray-blue)

      Dark mode: Deeper variants of above with reduced lightness

      Text: High contrast for readability (WCAG AA compliant)
    </color_palette>
    <typography>
      System font stack: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif
      Temperature: Very large, bold weight
      Labels: Medium size, regular weight
      Timestamps: Small, subtle color
    </typography>
  </design_system>

  <implementation_steps>
    <step number="1">
      <title>Foundation & Setup</title>
      <tasks>
        - Initialize React + Vite project with TypeScript
        - Configure Tailwind CSS
        - Set up PWA manifest and service worker
        - Create base app structure and routing
      </tasks>
    </step>
    <step number="2">
      <title>Open-Meteo API Integration</title>
      <tasks>
        - Create API client for Open-Meteo
        - Implement current weather fetch
        - Implement daily forecast fetch
        - Parse weather codes into conditions
        - Add error handling and retry logic
      </tasks>
    </step>
    <step number="3">
      <title>Location Services</title>
      <tasks>
        - Implement Geolocation API integration
        - Create location permission screen
        - Handle permission denied state
        - Implement reverse geocoding for city name
        - Add GPS timeout handling
      </tasks>
    </step>
    <step number="4">
      <title>Weather Display UI</title>
      <tasks>
        - Build main weather screen layout
        - Display temperature, feels like, conditions
        - Add quick stats (high/low, UV, wind, precip)
        - Show sunrise/sunset times
        - Implement "Last updated" timestamp
      </tasks>
    </step>
    <step number="5">
      <title>Outfit Logic Engine</title>
      <tasks>
        - Create temperature bucket mapping (freezing/cold/cool/mild/warm/hot)
        - Implement weather code modifiers (rain/snow/fog)
        - Add wind speed modifier logic
        - Add UV index modifier logic
        - Add precipitation probability logic
        - Create outfit emoji combinations for each scenario
        - Generate friendly one-liner text
      </tasks>
    </step>
    <step number="6">
      <title>Drawer Component</title>
      <tasks>
        - Build swipe-up gesture handling
        - Create collapsed state with handle bar
        - Create expanded state with outfit display
        - Implement spring animation (physics-based)
        - Add Previous/Now navigation buttons
        - Create frosted glass background effect
      </tasks>
    </step>
    <step number="7">
      <title>Adaptive Backgrounds</title>
      <tasks>
        - Map weather conditions to color palette
        - Implement background color transitions
        - Add dark/light mode support
        - Ensure text contrast remains readable
      </tasks>
    </step>
    <step number="8">
      <title>Caching & Offline</title>
      <tasks>
        - Implement localStorage/IndexedDB caching
        - Show cached data on app load
        - Add 30-minute expiry logic
        - Implement background refresh
        - Update UI seamlessly when fresh data arrives
      </tasks>
    </step>
    <step number="9">
      <title>Loading & Error States</title>
      <tasks>
        - Create initial loading animation
        - Build 1-second threshold skeleton/fallback
        - Create error screens for all failure scenarios
        - Add friendly copy and retry buttons
        - Implement fallback outfit logic for missing data
      </tasks>
    </step>
    <step number="10">
      <title>Settings & Units</title>
      <tasks>
        - Create settings modal
        - Implement locale auto-detection (C vs F, km/h vs mph)
        - Add unit toggles with persistence
        - Update all displays to respect selected units
      </tasks>
    </step>
    <step number="11">
      <title>Pull-to-Refresh</title>
      <tasks>
        - Implement pull gesture detection
        - Add visual feedback during pull
        - Trigger data refresh on release
        - Show loading indicator during refresh
      </tasks>
    </step>
    <step number="12">
      <title>Accessibility & Polish</title>
      <tasks>
        - Add ARIA labels to all interactive elements
        - Implement screen reader announcements
        - Add aria-labels for emoji outfits
        - Verify WCAG AA color contrast
        - Add keyboard navigation support
        - Test with screen reader
      </tasks>
    </step>
    <step number="13">
      <title>PWA Completion</title>
      <tasks>
        - Complete service worker implementation
        - Add install prompt logic (after 2nd visit)
        - Create app icons and splash screen
        - Test offline functionality
        - Verify installability on mobile devices
      </tasks>
    </step>
    <step number="14">
      <title>Testing & Refinement</title>
      <tasks>
        - Test on actual mobile devices (iOS and Android)
      </tasks>
    </step>
  </implementation_steps>

  <success_criteria>
    <functionality>
      - Successfully fetches real weather data from Open-Meteo API
      - Outfit recommendations are accurate and contextually appropriate
      - GPS location works and handles permission states gracefully
      - Caching works for offline and resume scenarios
      - Pull-to-refresh updates data correctly
      - Unit toggles persist and update all displays
    </functionality>
    <user_experience>
      - App feels instant (cached data shows immediately)
      - Drawer swipe animation feels smooth and native
      - Error states are friendly and guide users to resolution
      - "Last updated" timestamp builds trust in data freshness
      - Overall experience is delightful, not cluttered
    </user_experience>
    <technical_quality>
      - PWA installs successfully on mobile devices
      - Works offline with cached data
      - Compatible with modern browsers (Chrome, Safari, Firefox, Edge)
      - No console errors or warnings
      - Fast load times and smooth animations
    </technical_quality>
    <design_polish>
      - Adaptive backgrounds match weather conditions appropriately
      - Typography hierarchy is clear and readable
      - Spacing and layout feel refined
      - Emoji outfits are clear and large enough to read
      - Dark/light mode switch is seamless
    </design_polish>
    <accessibility>
      - WCAG AA color contrast compliance
      - Screen reader announces outfit and one-liner correctly
      - Keyboard navigation works for all interactions
      - Semantic HTML structure throughout
    </accessibility>
  </success_criteria>
</project_specification>
